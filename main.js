(()=>{"use strict";var e=document.querySelector("#popup__addPost-container").parentNode,t=document.querySelector("#popup__profileEdit-container").parentNode,n=document.querySelector("#popup__imageZoom-container").parentNode,r=document.querySelector("#popup__patchAvatar-container").parentNode,o=(document.querySelectorAll(".popup"),document.querySelector(".page"),document.querySelector(".content").querySelector(".profile")),i=document.querySelector(".posts__list"),a=document.querySelector(".post-template").content,c=(t.querySelector(".popup__person-information"),e.querySelector(".popup__person-information"),r.querySelector(".popup__person-information"),o.querySelector(".profile__name")),u=o.querySelector(".profile__status"),s=t.querySelector(".popup__input_type_name"),l=t.querySelector(".popup__input_type_about"),p=e.querySelector(".popup__input_type_name"),f=e.querySelector(".popup__input_type_image"),d=r.querySelector(".popup__input_type_url"),h=(n.querySelector(".popup__zoom-image"),n.querySelector(".popup__zoom-caption"),document.querySelector(".profile__name"),document.querySelector(".profile__status"),document.querySelector(".profile__avatar")),y=o.querySelector(".button-add"),b=(e.querySelector(".button-close"),o.querySelector(".button-edit")),_=(t.querySelector(".button-close"),n.querySelector(".button-close"),o.querySelector(".button-avatar"));function v(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function m(e,t,n){return t&&v(e.prototype,t),n&&v(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function g(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}r.querySelector(".button-close");var k=m((function e(t){var n=this,r=t.baseUrl,o=t.headers;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),g(this,"_checkErrors",(function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})),g(this,"getInitialCards",(function(){return fetch("".concat(n.baseUrl,"/cards"),{method:"GET",headers:n.headers}).then((function(e){return n._checkErrors(e)}))})),g(this,"getInformationAbout",(function(){return fetch("".concat(n.baseUrl,"/users/me"),{headers:n.headers}).then((function(e){return n._checkErrors(e)}))})),g(this,"postCard",(function(e,t){return fetch("".concat(n.baseUrl,"/cards"),{method:"POST",headers:n.headers,body:JSON.stringify({name:e,link:t})}).then((function(e){return n._checkErrors(e)}))})),g(this,"deleteCard",(function(e){return fetch("".concat(n.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:n.headers}).then((function(e){return n._checkErrors(e)}))})),g(this,"postUserAvatar",(function(e){return fetch("".concat(n.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:n.headers,body:JSON.stringify({avatar:e})}).then((function(e){return n._checkErrors(e)}))})),g(this,"postUserInformation",(function(e,t){return fetch("".concat(n.baseUrl,"/users/me"),{method:"PATCH",headers:n.headers,body:JSON.stringify({name:e,about:t})}).then((function(e){return n._checkErrors(e)}))})),g(this,"putLike",(function(e){return fetch("".concat(n.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:n.headers}).then((function(e){return n._checkErrors(e)}))})),g(this,"deleteLike",(function(e){return fetch("".concat(n.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:n.headers}).then((function(e){return n._checkErrors(e)}))})),this.baseUrl=r,this.headers=o}));function S(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var w=function(){function e(t,n,r,o,i,a,c,u){var s=u.delLikeHandler,l=u.putLikeHandler,p=u.delCardHandler,f=u.openZoomHandler;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name=t,this.link=n,this.ownerId=r,this.myId=o,this.cardId=i,this.likes=a,this.selector=c,this._delLikeHandler=s,this._putLikeHandler=l,this._delCardHandler=p,this._openZoomHandler=f}var t,n;return t=e,(n=[{key:"_checkActiveLike",value:function(e){var t=this;this.likes.forEach((function(n){t.myId==n._id&&e.classList.add("button-like_active")}))}},{key:"_checkCardOwner",value:function(e){this.myId!==this.ownerId&&e.classList.add("button-trash_disabled")}},{key:"_addDomCardInfo",value:function(e,t){t.src=this.link,e.querySelector(".posts__title").textContent=this.name,t.alt=this.name}},{key:"_changeLikeVisibility",value:function(e,t){0!==this.likes.length?e.textContent=this.likes.length:(e.style.display="none",t.style.padding="30px 0 0 0")}},{key:"createNewPost",value:function(){var e=this,t=a.querySelector(this.selector).cloneNode(!0),n=t.querySelector(".posts__image"),r=t.querySelector(".button-trash"),o=t.querySelector(".posts__like-count"),i=t.querySelector(".posts__like-container"),c=t.querySelector(".button-like");return this._checkActiveLike(c),this._checkCardOwner(r),this._addDomCardInfo(t,n),this._changeLikeVisibility(o,i),c.addEventListener("click",(function(t){t.target.classList.contains("button-like_active")?e._delLikeHandler(e.cardId,t,o,i):e._putLikeHandler(e.cardId,t,o,i)})),r.addEventListener("click",(function(t){e._delCardHandler(e.cardId,t)})),n.addEventListener("click",(function(){e._openZoomHandler(e.name,e.link)})),t}}])&&S(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function E(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function O(e,t,n){return t&&E(e.prototype,t),n&&E(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function L(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var C=O((function e(t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),L(this,"_showInputError",(function(e,t,n,r){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(r.inputErrorClass),o.classList.add(r.errorClass),o.textContent=n})),L(this,"_hideInputError",(function(e,t,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass),r.textContent=""})),L(this,"_checkInputValidity",(function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?r._hideInputError(e,t,n):r._showInputError(e,t,t.validationMessage,n)})),L(this,"_hasInvalidInput",(function(e){return e.some((function(e){return!e.validity.valid}))})),L(this,"_toggleButtonState",(function(e,t,n){r._hasInvalidInput(e,t)?(t.classList.add(n.inactiveButtonClass),t.setAttribute("disabled","disabled")):(t.classList.remove(n.inactiveButtonClass),t.removeAttribute("disabled","disabled"))})),L(this,"_setEventListeners",(function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);r._toggleButtonState(n,o,t),n.forEach((function(i){i.addEventListener("input",(function(){r._checkInputValidity(e,i,t),r._toggleButtonState(n,o,t)}))}))})),L(this,"enableValidation",(function(){Array.from(document.querySelectorAll(r.validObj.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),r._setEventListeners(e,r.validObj)}))})),L(this,"resetForm",(function(){var e=r.popup.querySelectorAll(r.validObj.errorSpanSelector),t=r.popup.querySelectorAll(r.validObj.inputSelector);e.forEach((function(e){e.classList.remove(r.validObj.errorClass)})),t.forEach((function(e){e.classList.remove(r.validObj.inputErrorClass)})),r._disableButton()})),L(this,"_disableButton",(function(){r.popup.querySelector(".button-save").classList.add("button_inactive"),r.popup.querySelector(".button-save").setAttribute("disabled","disabled")})),this.validObj=t,this.popup=n}));function q(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function j(e,t,n){return t&&q(e.prototype,t),n&&q(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function P(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var I=j((function e(t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),P(this,"getUserInfo",(function(){return{name:r.userName.textContent,about:r.userAbout.textContent}})),P(this,"setUserInfo",(function(e){r.userName.textContent=e.name,r.userAbout.textContent=e.about})),this.userName=t,this.userAbout=n}));function A(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var x=function(){function e(t,n){var r,o,i=this,a=t.items,c=t.renderer;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),o=function(){i.items.forEach((function(e){i.renderer(e)}))},(r="renderAll")in this?Object.defineProperty(this,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):this[r]=o,this.items=a,this.renderer=c,this.container=n}var t,n;return t=e,n=[{key:"addItem",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];t?this.container.append(e):this.container.prepend(e)}}],n&&A(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function H(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function T(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var U=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),T(this,"_handleEscClose",(function(e){"Escape"===e.key&&document.querySelector(".popup_opened")&&document.querySelector(".popup_opened").classList.remove("popup_opened")})),T(this,"_handleOutClose",(function(e){(e.target.classList.contains("popup_opened")||e.target.classList.contains("button-close"))&&n.close()})),this._popup=document.getElementById(t).parentNode,this.close=this.close.bind(this)}var t,n;return t=e,(n=[{key:"open",value:function(){this._popup.classList.add("popup_opened"),document.addEventListener("keydown",this._handleEscClose)}},{key:"close",value:function(){this._popup.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleEscClose)}},{key:"setEventListeners",value:function(){var e=this;this._popup.addEventListener("click",(function(t){return e._handleOutClose(t)}))}}])&&H(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function R(e){return R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},R(e)}function B(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function N(){return N="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=D(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},N.apply(this,arguments)}function D(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Z(e)););return e}function V(e,t){return V=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},V(e,t)}function F(e,t){if(t&&("object"===R(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function Z(e){return Z=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Z(e)}var z=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&V(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Z(r);if(o){var n=Z(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return F(this,e)});function a(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=i.call(this,e))._callback=t,n._inputList=n._popup.querySelectorAll(".popup__input"),n._button=n._popup.querySelector(".button-save"),n._formPopup=n._popup.querySelector(".popup__person-information"),n}return t=a,(n=[{key:"_getInputValues",value:function(){var e=[];return this._inputList.forEach((function(t){e.push(t.value)})),e}},{key:"setEventListeners",value:function(){var e=this;N(Z(a.prototype),"setEventListeners",this).call(this),this._formPopup.addEventListener("submit",(function(t){t.preventDefault(),e._callback(e._getInputValues())}))}},{key:"close",value:function(){N(Z(a.prototype),"close",this).call(this),this._formPopup.reset()}}])&&B(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(U);function J(e){return J="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},J(e)}function M(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function G(){return G="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=K(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},G.apply(this,arguments)}function K(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=X(e)););return e}function Q(e,t){return Q=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Q(e,t)}function W(e,t){if(t&&("object"===J(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function X(e){return X=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},X(e)}var Y,$=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Q(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=X(r);if(o){var n=X(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return W(this,e)});function a(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=i.call(this,e))._image=t._popup.querySelector(".popup__zoom-image"),t._title=t._popup.querySelector(".popup__zoom-caption"),t}return t=a,(n=[{key:"open",value:function(e,t){this._image.src=t,this._title.textContent=e,this._image.alt=e,G(X(a.prototype),"open",this).call(this)}}])&&M(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(U),ee=new k({baseUrl:"https://nomoreparties.co/v1/plus-cohort-14",headers:{authorization:"175227b7-8396-4cce-a64b-f428eae8eca2","Content-Type":"application/json; charset=UTF-8"}}),te=new I(c,u),ne=new $("popup__imageZoom-container");function re(e,t,n,r){ee.deleteLike(e).then((function(e){t.target.classList.remove("button-like_active"),function(e,t,n){0==e.likes.length?(t.style.display="none",n.style.padding="30px 0 0 0"):t.textContent=e.likes.length}(e,n,r)})).catch((function(e){console.log(e)}))}function oe(e,t,n,r){ee.putLike(e).then((function(e){t.target.classList.add("button-like_active"),function(e,t,n){1==e.likes.length?(t.style.display="block",n.style.padding="22px 0 0 0",t.textContent=e.likes.length):t.textContent=e.likes.length}(e,n,r)})).catch((function(e){console.log(e)}))}function ie(e,t){ee.deleteCard(e).then((function(){!function(e){e.target.closest(".posts__post").remove()}(t)})).catch((function(e){console.log(e)}))}var ae={formSelector:".popup__person-information",inputSelector:".popup__input",submitButtonSelector:".button-save",inactiveButtonClass:"button_inactive",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active",errorSpanSelector:".popup__input-error"};function ce(e){i.append(e)}function ue(e,t){t.textContent=e?"Сохранение...":"Сохранить"}Promise.all([ee.getInformationAbout(),ee.getInitialCards()]).then((function(e){s.textContent=e[0].name,l.textContent=e[0].about,c.textContent=e[0].name,u.textContent=e[0].about,h.src=e[0].avatar,d.value="",Y=e[0]._id;var t=[];e[1].forEach((function(e){var n=new w(e.name,e.link,e.owner._id,Y,e._id,e.likes,".posts__post",{delLikeHandler:re,putLikeHandler:oe,delCardHandler:ie,openZoomHandler:function(e,t){ne.open(e,t)}});t.push(n.createNewPost())})),new x({items:t,renderer:ce},i).renderAll()})).catch((function(e){console.log(e)})),new C(ae).enableValidation();var se=new z("popup__profileEdit-container",(function(){var e=t.querySelector(".button-save");ue(!0,e);var n=s.value,r=l.value;ee.postUserInformation(n,r).then((function(e){te.setUserInfo(e),se.close()})).catch((function(e){console.log(e)})).finally((function(){ue(!1,e)}))})),le=new z("popup__patchAvatar-container",(function(){var e=r.querySelector(".button-save");ue(!0,e);var t=d.value;ee.postUserAvatar(t).then((function(){h.src=t,le.close(),de.resetForm()})).catch((function(e){console.log(e)})).finally((function(){ue(!1,e)}))})),pe=new z("popup__addPost-container",(function(t){var n=e.querySelector(".button-save");ue(!0,n);var r=p.value,o=f.value;ee.postCard(r,o).then((function(e){var t=new w(e.name,e.link,e.owner._id,Y,e._id,e.likes,".posts__post",{delLikeHandler:re,putLikeHandler:oe,delCardHandler:ie,openZoomHandler:function(e,t){ne.open(e,t)}});new x({},i).addItem(t.createNewPost(),!1),pe.close(),he.resetForm()})).catch((function(e){console.log(e)})).finally((function(){ue(!1,n)}))})),fe=new C(ae,t),de=new C(ae,r),he=new C(ae,e);y.addEventListener("click",(function(){pe.open(),he.resetForm()})),b.addEventListener("click",(function(){se.open();var e=te.getUserInfo();s.value=e.name,l.value=e.about,fe.resetForm()})),_.addEventListener("click",(function(){le.open(),de.resetForm()})),ne.setEventListeners(),le.setEventListeners(),pe.setEventListeners(),se.setEventListeners()})();
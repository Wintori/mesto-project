(()=>{"use strict";var e,t,n=document.querySelector("#popup__addPost-container").parentNode,o=document.querySelector("#popup__profileEdit-container").parentNode,r=document.querySelector("#popup__imageZoom-container").parentNode,a=document.querySelector("#popup__patchAvatar-container").parentNode,c=document.querySelectorAll(".popup"),u=(document.querySelector(".page"),document.querySelector(".content").querySelector(".profile")),i=document.querySelector(".posts__list"),s=document.querySelector(".post-template").content,l=o.querySelector(".popup__person-information"),p=n.querySelector(".popup__person-information"),d=a.querySelector(".popup__person-information"),_=u.querySelector(".profile__name"),f=u.querySelector(".profile__status"),v=o.querySelector(".popup__input_type_name"),y=o.querySelector(".popup__input_type_about"),m=n.querySelector(".popup__input_type_name"),h=n.querySelector(".popup__input_type_image"),S=a.querySelector(".popup__input_type_url"),b=r.querySelector(".popup__zoom-image"),q=r.querySelector(".popup__zoom-caption"),L=(document.querySelector(".profile__name"),document.querySelector(".profile__status"),document.querySelector(".profile__avatar")),E=u.querySelector(".button-add"),k=n.querySelector(".button-close"),C=u.querySelector(".button-edit"),g=o.querySelector(".button-close"),x=r.querySelector(".button-close"),A=u.querySelector(".button-avatar"),U=a.querySelector(".button-close"),T={baseUrl:"https://nomoreparties.co/v1/plus-cohort-14",headers:{authorization:"175227b7-8396-4cce-a64b-f428eae8eca2","Content-Type":"application/json; charset=UTF-8"}},N=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},P=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.removeAttribute("disabled","disabled")):(t.classList.add(n.inactiveButtonClass),t.setAttribute("disabled","disabled"))},D=function(e,t){e.forEach((function(e){e.classList.remove("popup__input-error_active")})),t.forEach((function(e){e.classList.remove("popup__input_type_error")}))},B=function(e){e.classList.add("button_inactive"),e.setAttribute("disabled","disabled")};function O(e){e.classList.add("popup_opened")}function j(e){e.classList.remove("popup_opened")}function w(e){b.src=e.target.src,b.alt=e.target.alt,q.textContent=e.target.alt,O(r)}function z(e,t,n,o,r,a){var c=s.cloneNode(!0),u=c.querySelector(".posts__image"),i=c.querySelector(".button-trash"),l=c.querySelector(".posts__like-count"),p=c.querySelector(".posts__like-container"),d=c.querySelector(".button-like");return a.forEach((function(e){o==e._id&&d.classList.add("button-like_active")})),o!==n&&i.classList.add("button-trash_disabled"),u.src=t,c.querySelector(".posts__title").textContent=e,u.alt=e,0!==a.length?l.textContent=a.length:(l.style.display="none",p.style.padding="30px 0 0 0"),d.addEventListener("click",(function(e){e.target.classList.contains("button-like_active")?(e.target.classList.remove("button-like_active"),function(e){return fetch("".concat(T.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:T.headers}).then((function(e){return N(e)}))}(r).then((function(e){0==e.likes.length?(l.style.display="none",p.style.padding="30px 0 0 0"):l.textContent=e.likes.length}))):(e.target.classList.add("button-like_active"),function(e){return fetch("".concat(T.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:T.headers}).then((function(e){return N(e)}))}(r).then((function(e){1==e.likes.length?(l.style.display="block",p.style.padding="22px 0 0 0",l.textContent=e.likes.length):l.textContent=e.likes.length})))})),i.addEventListener("click",(function(e){!function(e){fetch("".concat(T.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:T.headers}).then((function(e){return N(e)}))}(r),e.target.closest(".posts__post").remove()})),u.addEventListener("click",w),c}function J(e,t){t.textContent=e?"Сохранение...":"Сохранить"}k.addEventListener("click",(function(){return n.classList.remove("popup_opened")})),C.addEventListener("click",(function(){v.value=_.textContent,y.value=f.textContent,O(o)})),g.addEventListener("click",(function(){return o.classList.remove("popup_opened")})),x.addEventListener("click",(function(){return r.classList.remove("popup_opened")})),A.addEventListener("click",(function(){B(a.querySelector(".button-save"));var e=a.querySelectorAll(".popup__input-error"),t=a.querySelectorAll(".popup__input");D(e,t),S.value=null,O(a)})),U.addEventListener("click",(function(){return a.classList.remove("popup_opened")})),document.addEventListener("click",(function(e){e.target.classList.contains("popup")&&!e.target.classList.contains("popup__container")&&c.forEach((function(e){j(e)}))})),document.addEventListener("keydown",(function(e){27===e.keyCode&&c.forEach((function(e){j(e)}))})),E.addEventListener("click",(function(){B(n.querySelector(".button-save"));var e=n.querySelectorAll(".popup__input-error"),t=n.querySelectorAll(".popup__input");D(e,t),m.value=null,h.value=null,O(n)})),Promise.all([fetch("".concat(T.baseUrl,"/users/me"),{headers:T.headers}).then((function(e){return N(e)})),fetch("".concat(T.baseUrl,"/cards"),{method:"GET",headers:T.headers}).then((function(e){return N(e)}))]).then((function(t){v.textContent=t[0].name,y.textContent=t[0].about,_.textContent=t[0].name,f.textContent=t[0].about,L.src=t[0].avatar,S.value="",e=t[0]._id,t[1].forEach((function(t){var n=z(t.name,t.link,t.owner._id,e,t._id,t.likes);i.append(n)}))})),t={formSelector:".popup__person-information",inputSelector:".popup__input",submitButtonSelector:".button-save",inactiveButtonClass:"button_inactive",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"},Array.from(document.querySelectorAll(t.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);P(n,o,t),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.classList.add(o.errorClass),r.textContent=n}(e,t,t.validationMessage,n)}(e,r,t),P(n,o,t)}))}))}(e,t)})),l.addEventListener("submit",(function(e){e.preventDefault();var t,n,r=o.querySelector(".button-save");J(!0,r),(t=v.value,n=y.value,fetch("".concat(T.baseUrl,"/users/me"),{method:"PATCH",headers:T.headers,body:JSON.stringify({name:t,about:n})}).then((function(e){return N(e)}))).then((function(e){_.textContent=e.name,f.textContent=e.about,j(o)})).finally((function(){J(!1,r)}))})),p.addEventListener("submit",(function(t){t.preventDefault();var o,r,a=n.querySelector(".button-save");J(!0,a),(o=m.value,r=h.value,fetch("".concat(T.baseUrl,"/cards"),{method:"POST",headers:T.headers,body:JSON.stringify({name:o,link:r})}).then((function(e){return N(e)}))).then((function(t){var o=z(t.name,t.link,t.owner._id,e,t._id,t.likes);i.prepend(o),j(n)})).finally((function(){J(!1,a)}))})),d.addEventListener("submit",(function(e){e.preventDefault();var t=a.querySelector(".button-save");J(!0,t);var n,o=S.value;(n=o,fetch("".concat(T.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:T.headers,body:JSON.stringify({avatar:n})}).then((function(e){return N(e)}))).then((function(e){L.src=o,j(a)})).finally((function(){J(!1,t)}))}))})();
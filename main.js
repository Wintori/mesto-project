(()=>{"use strict";var e=document.querySelector("#popup__addPost-container").parentNode,t=document.querySelector("#popup__profileEdit-container").parentNode,n=document.querySelector("#popup__imageZoom-container").parentNode,o=document.querySelector("#popup__patchAvatar-container").parentNode,r=(document.querySelectorAll(".popup"),document.querySelector(".page"),document.querySelector(".content").querySelector(".profile")),c=document.querySelector(".posts__list"),a=document.querySelector(".post-template").content,u=t.querySelector(".popup__person-information"),i=e.querySelector(".popup__person-information"),s=o.querySelector(".popup__person-information"),l=r.querySelector(".profile__name"),p=r.querySelector(".profile__status"),d=t.querySelector(".popup__input_type_name"),f=t.querySelector(".popup__input_type_about"),_=e.querySelector(".popup__input_type_name"),v=e.querySelector(".popup__input_type_image"),y=o.querySelector(".popup__input_type_url"),m=n.querySelector(".popup__zoom-image"),h=n.querySelector(".popup__zoom-caption"),S=(document.querySelector(".profile__name"),document.querySelector(".profile__status"),document.querySelector(".profile__avatar")),b=r.querySelector(".button-add"),q=e.querySelector(".button-close"),L=r.querySelector(".button-edit"),E=t.querySelector(".button-close"),k=n.querySelector(".button-close"),C=r.querySelector(".button-avatar"),g=o.querySelector(".button-close"),x={baseUrl:"https://nomoreparties.co/v1/plus-cohort-14",headers:{authorization:"175227b7-8396-4cce-a64b-f428eae8eca2","Content-Type":"application/json; charset=UTF-8"}},A=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))};function U(e,t,n,o,r,c,u){var i=a.querySelector(".posts__post").cloneNode(!0),s=i.querySelector(".posts__image"),l=i.querySelector(".button-trash"),p=i.querySelector(".posts__like-count"),d=i.querySelector(".posts__like-container"),f=i.querySelector(".button-like");return c.forEach((function(e){o==e._id&&f.classList.add("button-like_active")})),o!==n&&l.classList.add("button-trash_disabled"),s.src=t,i.querySelector(".posts__title").textContent=e,s.alt=e,0!==c.length?p.textContent=c.length:(p.style.display="none",d.style.padding="30px 0 0 0"),f.addEventListener("click",(function(e){e.target.classList.contains("button-like_active")?function(e,t,n,o){(function(e){return fetch("".concat(x.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:x.headers}).then((function(e){return A(e)}))})(e).then((function(e){t.target.classList.remove("button-like_active"),function(e,t,n){0==e.likes.length?(t.style.display="none",n.style.padding="30px 0 0 0"):t.textContent=e.likes.length}(e,n,o)})).catch((function(e){console.log(e)}))}(r,e,p,d):function(e,t,n,o){(function(e){return fetch("".concat(x.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:x.headers}).then((function(e){return A(e)}))})(e).then((function(e){t.target.classList.add("button-like_active"),function(e,t,n){1==e.likes.length?(t.style.display="block",n.style.padding="22px 0 0 0",t.textContent=e.likes.length):t.textContent=e.likes.length}(e,n,o)})).catch((function(e){console.log(e)}))}(r,e,p,d)})),l.addEventListener("click",(function(e){!function(e,t){(function(e){return fetch("".concat(x.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:x.headers}).then((function(e){return A(e)}))})(e).then((function(){t.target.closest(".posts__post").remove()})).catch((function(e){console.log(e)}))}(r,e)})),s.addEventListener("click",u),i}var T,N=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.removeAttribute("disabled","disabled")):(t.classList.add(n.inactiveButtonClass),t.setAttribute("disabled","disabled"))},P=function(e,t){var n=e.querySelectorAll(t.errorSpanSelector),o=e.querySelectorAll(t.inputSelector);n.forEach((function(e){e.classList.remove(t.errorClass)})),o.forEach((function(e){e.classList.remove(t.inputErrorClass)}))},D=function(e){e.classList.add("button_inactive"),e.setAttribute("disabled","disabled")};function B(e){e.classList.add("popup_opened"),document.addEventListener("keydown",O),document.addEventListener("click",j)}function w(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",O),document.removeEventListener("click",j)}function O(e){"Escape"===e.key&&document.querySelector(".popup_opened")&&document.querySelector(".popup_opened").classList.remove("popup_opened")}function j(e){e.target.classList.contains("popup")&&!e.target.classList.contains("popup__container")&&e.target.classList.remove("popup_opened")}var z={formSelector:".popup__person-information",inputSelector:".popup__input",submitButtonSelector:".button-save",inactiveButtonClass:"button_inactive",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active",errorSpanSelector:".popup__input-error"};function J(e,t){t.textContent=e?"Сохранение...":"Сохранить"}function M(){w(o)}function H(){w(e)}function V(e){m.src=e.target.src,m.alt=e.target.alt,h.textContent=e.target.alt,B(n)}function F(){w(t)}Promise.all([fetch("".concat(x.baseUrl,"/users/me"),{headers:x.headers}).then((function(e){return A(e)})),fetch("".concat(x.baseUrl,"/cards"),{method:"GET",headers:x.headers}).then((function(e){return A(e)}))]).then((function(e){d.textContent=e[0].name,f.textContent=e[0].about,l.textContent=e[0].name,p.textContent=e[0].about,S.src=e[0].avatar,y.value="",T=e[0]._id,e[1].forEach((function(e){var t=U(e.name,e.link,e.owner._id,T,e._id,e.likes,V);c.append(t)}))})).catch((function(e){console.log(e)})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);N(n,o,t),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.classList.add(o.errorClass),r.textContent=n}(e,t,t.validationMessage,n)}(e,r,t),N(n,o,t)}))}))}(t,e)}))}(z),b.addEventListener("click",(function(){D(e.querySelector(".button-save")),P(e,{inputSelector:".popup__input",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active",errorSpanSelector:".popup__input-error"}),_.value="",v.value="",B(e)})),q.addEventListener("click",H),L.addEventListener("click",(function(){d.value=l.textContent,f.value=p.textContent,B(t)})),E.addEventListener("click",F),k.addEventListener("click",(function(){w(n)})),C.addEventListener("click",(function(){D(o.querySelector(".button-save")),P(o,z),y.value="",B(o)})),g.addEventListener("click",M),u.addEventListener("submit",(function(e){e.preventDefault();var n,o,r=t.querySelector(".button-save");J(!0,r),(n=d.value,o=f.value,fetch("".concat(x.baseUrl,"/users/me"),{method:"PATCH",headers:x.headers,body:JSON.stringify({name:n,about:o})}).then((function(e){return A(e)}))).then((function(e){l.textContent=e.name,p.textContent=e.about,F()})).finally((function(){J(!1,r)}))})),i.addEventListener("submit",(function(t){t.preventDefault();var n,o,r=e.querySelector(".button-save");J(!0,r),(n=_.value,o=v.value,fetch("".concat(x.baseUrl,"/cards"),{method:"POST",headers:x.headers,body:JSON.stringify({name:n,link:o})}).then((function(e){return A(e)}))).then((function(e){var t=U(e.name,e.link,e.owner._id,T,e._id,e.likes,V);c.prepend(t),H()})).finally((function(){J(!1,r)}))})),s.addEventListener("submit",(function(e){e.preventDefault();var t=o.querySelector(".button-save");J(!0,t);var n,r=y.value;(n=r,fetch("".concat(x.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:x.headers,body:JSON.stringify({avatar:n})}).then((function(e){return A(e)}))).then((function(e){S.src=r,M()})).finally((function(){J(!1,t)}))}))})();